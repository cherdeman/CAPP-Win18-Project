{% extends "base.html" %}

{% block lljs %}
		{% load leaflet_tags %}
        {% leaflet_js %}
        {% leaflet_css %}
{% endblock %}

{% block main %}
<div class="rightbar">
	<h3> Select an indicator: </h3>
   	<form method="post">
        {% csrf_token %}
        <table class="form" align="center">    
            <tr>              
                <td>{{ form.as_p }} </td>
            </tr>
            <tr>
                <td>
                    <input type="submit" value="Submit">
                </td>
            </tr>
        </table>
    </form>
    <h3>
        <b> Explanation of indicators: </b>
    </h3>
    <ul>
        <li> <b> Percent white or black: </b> Percentage of residents that are of the given race </li> 
        <li> <b> Median home value: </b> The median home value as reported on the US Censuss; not available for 1950, 1960, and 1970 </li>
        <li><b> Percent vacant: </b> Share of the homes that are unoccupied </li>
        <li><b> Percent owner or renter occupied: </b> Share of occupied homes that are owned or rented </li>
    </ul>
</div>


<div class="map">
		<map>
            {% leaflet_map "main" callback="mainmap" %}
        </map>
        <script type="text/javascript">

            function mainmap(map, options) {
                data = JSON.parse("{{ data|escapejs }}");
                args = JSON.parse("{{ args|escapejs }}");
                var_of_interest = args.ind.toLowerCase();
                
                console.log(data)
                console.log(var_of_interest)
                
                // CHLOROPLETH //
                // need this function to switch if not %, perhaps to indicate which scale is low/high?
                // change these color options to blues rather than reds
                function getColor(n) {
                    return n > .8 ? '#b10026'
                           : n > .7 ? '#e31a1c'
                           : n > .6 ? '#fc4e2a'
                           : n > .5 ? '#fd8d3c'
                           : n > .4  ? '#feb24c'
                           : n > .3  ? '#fed976'
                           : n > .2  ? '#ffeda0'
                           : n > .1  ? '#ffffcc'
                           : n > .0  ? '#ffffcc'
                           : '#85929E';
                }

                function getBufferColor(feature) {
                    var color;
                    color = getColor(feature.properties[var_of_interest]);
                    return color;
                }

                function style(feature) {
                    return {
                        weight: 1,
                        opacity: 1,
                        color: 'black',
                        fillOpacity: 0.7,
                        fillColor: getBufferColor(feature)
                    };
                }
                
                // MOUSEOVER CONTROLS //
                // popup information as well?
                function highlightFeature(e) {
                    var layer = e.target;
                 
                    layer.setStyle({
                        weight: 2,
                        color: '#333',
                        dashArray: '',
                        fillOpacity: 0.7
                    });
                 
                    if (!L.Browser.ie && !L.Browser.opera) {
                        layer.bringToFront();
                    }
                 
                    info.update(layer.feature.properties);
                }


                function resetHighlight(e) {
                    geojson.resetStyle(e.target);
                    info.update();
                }
                 
                function zoomToFeature(e) {
                    map.fitBounds(e.target.getBounds());
                }
                 
                function onEachFeature(feature, layer) {
                    layer.on({
                        mouseover: highlightFeature,
                        mouseout: resetHighlight,
                        click: zoomToFeature
                    });
                }


                var geojson;

                geojson = L.geoJson(data, {
                    style: style,
                    onEachFeature: onEachFeature
                }).addTo(map);  

                //map.fitBounds(geojson.getBounds());    

            }

        </script>
	</div>

{% endblock %}